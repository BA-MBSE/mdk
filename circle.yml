machine:
  java:
    version: oraclejdk8

compile:
  override:
    - "./gradlew -PbuildNumber=$CIRCLE_BUILD_NUM -PbuildAccess=opensource -PbuildBranch=$CIRCLE_BRANCH --info distZip"

test:
  override:
    - "./gradlew -PbuildAccess=opensource -PbuildNumber=$CIRCLE_BUILD_NUM -PbuildBranch=$CIRCLE_BRANCH -PmagicDrawLicense=$MAGICDRAW_LICENSE --info test"
  post:
    - "mkdir -p $CIRCLE_TEST_REPORTS/junit/"
    - "find . -type f -regex \".*/build/test-results/.*xml\" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \\;"
    - "[ ! -d build/reports ] || cp -R build/reports $CIRCLE_ARTIFACTS/"

deployment:
  override:
    - "./gradlew -PbuildAccess=opensource -PbuildNumber=$CIRCLE_BUILD_NUM -PbuildBranch=$CIRCLE_BRANCH -Partifactory_user=$ARTIFACTORY_USER -Partifactory_password=$ARTIFACTORY_PASSWORD --info artifactoryPublish"